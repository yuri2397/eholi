{"version":3,"file":"ctrl-ngx-csv.js","sources":["../../src/lib/util.ts","../../src/lib/csv.directive.ts","../../src/lib/csv.module.ts","../../src/lib/ctrl-ngx-csv.ts"],"sourcesContent":["export interface HeaderObj {\n  label: string;\n  key: string;\n}\n\nexport const isJsons = (array: any[]) =>\n  Array.isArray(array) &&\n  array.every(row => typeof row === 'object' && !(row instanceof Array));\n\nexport const isArrays = (array: any[]) =>\n  Array.isArray(array) && array.every(row => Array.isArray(row));\n\nexport function jsonsHeaders(array: object[]) {\n  return Array.from(\n    new Set(\n      array.map(item => Object.keys(item)).reduce((a, b) => [...a, ...b], []),\n    ),\n  );\n}\n\nexport function jsons2arrays(\n  jsons: { [key: string]: string }[],\n  headers?: string[] | HeaderObj[],\n) {\n  headers = headers || jsonsHeaders(jsons);\n\n  // allow headers to have custom labels, defaulting to having the header data key be the label\n  let headerLabels: string[] = headers as string[];\n  let headerKeys: string[] = headers as string[];\n  if (isJsons(headers)) {\n    headerLabels = (headers as HeaderObj[]).map(header => header.label);\n    headerKeys = (headers as HeaderObj[]).map(header => header.key);\n  }\n\n  const data = jsons.map(object =>\n    headerKeys.map(header => (header in object ? object[header] : '')),\n  );\n  return [headerLabels, ...data];\n}\n\nexport const elementOrEmpty = (element: any) =>\n  element || element === 0 ? element : '';\n\nexport function joiner(data: any, delimiter = ',') {\n  return data\n    .map((row: any, index: number) =>\n      row.map((element: any) => '\"' + elementOrEmpty(element) + '\"').join(delimiter),\n    )\n    .join(`\\n`);\n}\n\nexport function arrays2csv(\n  data: string[][],\n  headers?: string[] | HeaderObj[],\n  delimiter?: string,\n) {\n  return joiner(headers ? [headers, ...data] : data, delimiter);\n}\n\nexport function jsons2csv(\n  data: { [key: string]: string }[],\n  headers?: string[] | HeaderObj[],\n  delimiter?: string,\n) {\n  return joiner(jsons2arrays(data, headers), delimiter);\n}\n\nexport function string2csv(\n  data: string,\n  headers?: string[],\n  delimiter?: string,\n) {\n  return headers ? `${headers.join(delimiter)}\\n${data}` : data;\n}\n\nexport function toCSV(\n  data: string | string[][] | { [key: string]: string }[] | any[],\n  headers?: string[] | HeaderObj[],\n  delimiter?: string,\n) {\n  if (isJsons(data as any)) {\n    return jsons2csv(data as { [key: string]: string }[], headers, delimiter);\n  }\n  if (isArrays(data as any)) {\n    return arrays2csv(data as string[][], headers, delimiter);\n  }\n  if (typeof data === 'string') {\n    return string2csv(data, headers as string[], delimiter);\n  }\n  throw new TypeError(\n    `Data should be a \"String\", \"Array of arrays\" OR \"Array of objects\" `,\n  );\n}\n\nexport function blob(\n  data: string | string[][] | { [key: string]: string }[] | any[],\n  uFEFF = true,\n  headers?: string[] | HeaderObj[],\n  delimiter?: string,\n) {\n  const csv = toCSV(data, headers, delimiter);\n  return new Blob([uFEFF ? '\\uFEFF' : '', csv], { type: 'text/csv' });\n}\n\nexport function buildURI(\n  data: string | string[][] | { [key: string]: string }[] | any[],\n  uFEFF = true,\n  headers?: string[] | HeaderObj[],\n  delimiter?: string,\n) {\n  return URL.createObjectURL(blob(data, uFEFF, headers, delimiter));\n}\n","import { Directive, HostBinding, HostListener, Input, OnChanges } from '@angular/core';\nimport { DomSanitizer, SafeResourceUrl } from '@angular/platform-browser';\n\nimport { blob, buildURI, HeaderObj } from './util';\n\n@Directive({ selector: '[csvLink]' })\nexport class CsvDirective implements OnChanges {\n  /** the body of the csv */\n  @Input() data: string | string[][] | { [key: string]: string }[] | any[] = [];\n  /** Set the first line of the csv */\n  @Input() headers?: string[] | HeaderObj[];\n  /** Set the seperator between values */\n  @Input() delimiter = ',';\n  /** Set the filename of the csv. Default is `data.csv` */\n  @Input()\n  set filename(a: string) {\n    this.download = a;\n  }\n  /** adds a Byte order mark to setup the csv as UTF-8  */\n  @Input() uFEFF = true;\n  @HostBinding() href?: SafeResourceUrl;\n  /** filename */\n  @HostBinding() download = 'data.csv';\n  @Input() @HostBinding() target = this.isIEBrowser() ? '' : '_blank';\n  constructor(private sanitizer: DomSanitizer) {}\n\n  @HostListener('click') onClick() {\n    // IE handling\n    if (this.isIEBrowser()) {\n      const file = blob(this.data, this.uFEFF, this.headers, this.delimiter);\n      window.navigator.msSaveBlob(file, this.download);\n    }\n  }\n\n  isIEBrowser(): boolean {\n    return !!window.navigator.msSaveOrOpenBlob;\n  }\n\n  ngOnChanges() {\n    this.href = this.sanitizer.bypassSecurityTrustResourceUrl(\n      buildURI(this.data, this.uFEFF, this.headers, this.delimiter),\n    );\n  }\n}\n","import { NgModule } from '@angular/core';\n\nimport { CsvDirective } from './csv.directive';\n\n@NgModule({\n  declarations: [CsvDirective],\n  exports: [CsvDirective],\n})\nexport class CsvModule {}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public_api';\n"],"names":[],"mappings":";;;MAKa,OAAO,GAAG,CAAC,KAAY,KAClC,KAAK,CAAC,OAAO,CAAC,KAAK,CAAC;IACpB,KAAK,CAAC,KAAK,CAAC,GAAG,IAAI,OAAO,GAAG,KAAK,QAAQ,IAAI,EAAE,GAAG,YAAY,KAAK,CAAC,EAAE;MAE5D,QAAQ,GAAG,CAAC,KAAY,KACnC,KAAK,CAAC,OAAO,CAAC,KAAK,CAAC,IAAI,KAAK,CAAC,KAAK,CAAC,GAAG,IAAI,KAAK,CAAC,OAAO,CAAC,GAAG,CAAC,EAAE;SAEjD,YAAY,CAAC,KAAe;IAC1C,OAAO,KAAK,CAAC,IAAI,CACf,IAAI,GAAG,CACL,KAAK,CAAC,GAAG,CAAC,IAAI,IAAI,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,CAAC,KAAK,CAAC,GAAG,CAAC,EAAE,GAAG,CAAC,CAAC,EAAE,EAAE,CAAC,CACxE,CACF,CAAC;AACJ,CAAC;SAEe,YAAY,CAC1B,KAAkC,EAClC,OAAgC;IAEhC,OAAO,GAAG,OAAO,IAAI,YAAY,CAAC,KAAK,CAAC,CAAC;;IAGzC,IAAI,YAAY,GAAa,OAAmB,CAAC;IACjD,IAAI,UAAU,GAAa,OAAmB,CAAC;IAC/C,IAAI,OAAO,CAAC,OAAO,CAAC,EAAE;QACpB,YAAY,GAAI,OAAuB,CAAC,GAAG,CAAC,MAAM,IAAI,MAAM,CAAC,KAAK,CAAC,CAAC;QACpE,UAAU,GAAI,OAAuB,CAAC,GAAG,CAAC,MAAM,IAAI,MAAM,CAAC,GAAG,CAAC,CAAC;KACjE;IAED,MAAM,IAAI,GAAG,KAAK,CAAC,GAAG,CAAC,MAAM,IAC3B,UAAU,CAAC,GAAG,CAAC,MAAM,KAAK,MAAM,IAAI,MAAM,GAAG,MAAM,CAAC,MAAM,CAAC,GAAG,EAAE,CAAC,CAAC,CACnE,CAAC;IACF,OAAO,CAAC,YAAY,EAAE,GAAG,IAAI,CAAC,CAAC;AACjC,CAAC;MAEY,cAAc,GAAG,CAAC,OAAY,KACzC,OAAO,IAAI,OAAO,KAAK,CAAC,GAAG,OAAO,GAAG,GAAG;SAE1B,MAAM,CAAC,IAAS,EAAE,SAAS,GAAG,GAAG;IAC/C,OAAO,IAAI;SACR,GAAG,CAAC,CAAC,GAAQ,EAAE,KAAa,KAC3B,GAAG,CAAC,GAAG,CAAC,CAAC,OAAY,KAAK,GAAG,GAAG,cAAc,CAAC,OAAO,CAAC,GAAG,GAAG,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC,CAC/E;SACA,IAAI,CAAC,IAAI,CAAC,CAAC;AAChB,CAAC;SAEe,UAAU,CACxB,IAAgB,EAChB,OAAgC,EAChC,SAAkB;IAElB,OAAO,MAAM,CAAC,OAAO,GAAG,CAAC,OAAO,EAAE,GAAG,IAAI,CAAC,GAAG,IAAI,EAAE,SAAS,CAAC,CAAC;AAChE,CAAC;SAEe,SAAS,CACvB,IAAiC,EACjC,OAAgC,EAChC,SAAkB;IAElB,OAAO,MAAM,CAAC,YAAY,CAAC,IAAI,EAAE,OAAO,CAAC,EAAE,SAAS,CAAC,CAAC;AACxD,CAAC;SAEe,UAAU,CACxB,IAAY,EACZ,OAAkB,EAClB,SAAkB;IAElB,OAAO,OAAO,GAAG,GAAG,OAAO,CAAC,IAAI,CAAC,SAAS,CAAC,KAAK,IAAI,EAAE,GAAG,IAAI,CAAC;AAChE,CAAC;SAEe,KAAK,CACnB,IAA+D,EAC/D,OAAgC,EAChC,SAAkB;IAElB,IAAI,OAAO,CAAC,IAAW,CAAC,EAAE;QACxB,OAAO,SAAS,CAAC,IAAmC,EAAE,OAAO,EAAE,SAAS,CAAC,CAAC;KAC3E;IACD,IAAI,QAAQ,CAAC,IAAW,CAAC,EAAE;QACzB,OAAO,UAAU,CAAC,IAAkB,EAAE,OAAO,EAAE,SAAS,CAAC,CAAC;KAC3D;IACD,IAAI,OAAO,IAAI,KAAK,QAAQ,EAAE;QAC5B,OAAO,UAAU,CAAC,IAAI,EAAE,OAAmB,EAAE,SAAS,CAAC,CAAC;KACzD;IACD,MAAM,IAAI,SAAS,CACjB,qEAAqE,CACtE,CAAC;AACJ,CAAC;SAEe,IAAI,CAClB,IAA+D,EAC/D,KAAK,GAAG,IAAI,EACZ,OAAgC,EAChC,SAAkB;IAElB,MAAM,GAAG,GAAG,KAAK,CAAC,IAAI,EAAE,OAAO,EAAE,SAAS,CAAC,CAAC;IAC5C,OAAO,IAAI,IAAI,CAAC,CAAC,KAAK,GAAG,QAAQ,GAAG,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,IAAI,EAAE,UAAU,EAAE,CAAC,CAAC;AACtE,CAAC;SAEe,QAAQ,CACtB,IAA+D,EAC/D,KAAK,GAAG,IAAI,EACZ,OAAgC,EAChC,SAAkB;IAElB,OAAO,GAAG,CAAC,eAAe,CAAC,IAAI,CAAC,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE,SAAS,CAAC,CAAC,CAAC;AACpE;;MCzGa,YAAY;IAkBvB,YAAoB,SAAuB;QAAvB,cAAS,GAAT,SAAS,CAAc;;QAhBlC,SAAI,GAA8D,EAAE,CAAC;;QAIrE,cAAS,GAAG,GAAG,CAAC;;QAOhB,UAAK,GAAG,IAAI,CAAC;;QAGP,aAAQ,GAAG,UAAU,CAAC;QACb,WAAM,GAAG,IAAI,CAAC,WAAW,EAAE,GAAG,EAAE,GAAG,QAAQ,CAAC;KACrB;;IAV/C,IACI,QAAQ,CAAC,CAAS;QACpB,IAAI,CAAC,QAAQ,GAAG,CAAC,CAAC;KACnB;IASsB,OAAO;;QAE5B,IAAI,IAAI,CAAC,WAAW,EAAE,EAAE;YACtB,MAAM,IAAI,GAAG,IAAI,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,KAAK,EAAE,IAAI,CAAC,OAAO,EAAE,IAAI,CAAC,SAAS,CAAC,CAAC;YACvE,MAAM,CAAC,SAAS,CAAC,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,QAAQ,CAAC,CAAC;SAClD;KACF;IAED,WAAW;QACT,OAAO,CAAC,CAAC,MAAM,CAAC,SAAS,CAAC,gBAAgB,CAAC;KAC5C;IAED,WAAW;QACT,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC,SAAS,CAAC,8BAA8B,CACvD,QAAQ,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,KAAK,EAAE,IAAI,CAAC,OAAO,EAAE,IAAI,CAAC,SAAS,CAAC,CAC9D,CAAC;KACH;;;YArCF,SAAS,SAAC,EAAE,QAAQ,EAAE,WAAW,EAAE;;;YAJ3B,YAAY;;;mBAOlB,KAAK;sBAEL,KAAK;wBAEL,KAAK;uBAEL,KAAK;oBAKL,KAAK;mBACL,WAAW;uBAEX,WAAW;qBACX,KAAK,YAAI,WAAW;sBAGpB,YAAY,SAAC,OAAO;;;MClBV,SAAS;;;YAJrB,QAAQ,SAAC;gBACR,YAAY,EAAE,CAAC,YAAY,CAAC;gBAC5B,OAAO,EAAE,CAAC,YAAY,CAAC;aACxB;;;ACPD;;;;;;"}